后台是egg.js, mongodb,用的阿里云服务器ubuntu系统

### 1. 17年12月份的时候,发现files这张表有50多个G,这张表主要存储的是图片资源,都是压缩过的,100kb一张左右,而我们服务器只有100G的硬盘,所以就买了阿里OSS来存储这些图片

### 2. 18年3月,发现统计接口响应很慢,调查是统计了太多数据,有20多万条,里面也有太多计算, 尝试了加索引,有些统计接口有效果,有些效果不明显
后面把需要统计的数据重新按照每天来生成对应的统计表,速度快了2,3倍,不过还是不太满意,后面有时间尝试把统计数据按年,按月,按天来生成对应的统计表

经验: 加索引,要用explain工具测试查询接口是否命中了索引
     aggregate里面不要有太多计算,数据量一大,会明显感觉速度降下来
     aggregate里面不要有太多group, unwind等操作,如果太多,就尝试重新设计统计表

### 3. 18年6月,发现日志有很多错误是图片上传OSS时,发生socket hang up错误,开启OSS日志也没有相关错误信息,暂时解决方案是重试,第一次上传失败,重试一次
猜测错误原因是上传图片经过ECS服务器再上传到OSS的,相当于1个图片上传有2个socket连接,网速只有10mb,就是差不多1.2M,最多只能1秒上传12张100KB的图片,如果并发太多,就容易出问题
解决方案是直接上传到OSS,不再经过ECS转一次